[env]
BINARY_NAME = "goto-bin"
VERSION = "1.0.0"

[tools]
go = "latest"

[tasks.build]
description = "Build the binary"
run = "go build -ldflags \"-X main.version=$VERSION\" -o $BINARY_NAME ./cmd/goto"

[tasks.install]
description = "Install binary and shell scripts"
depends = ["build"]
run = """
cp $BINARY_NAME /usr/local/bin/
mkdir -p /usr/local/share/goto
cp shell/* /usr/local/share/goto/
"""

[tasks.test]
description = "Run unit tests"
run = "go test ./internal/..."

[tasks.test-integration]
description = "Run integration tests"
depends = ["build"]
run = "go test -v ./test/integration/..."

[tasks.test-all]
description = "Run all tests (unit + integration)"
depends = ["build"]
run = """
go test ./internal/...
go test -v ./test/integration/...
"""

[tasks.test-cover]
description = "Run tests with coverage report"
run = """
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
"""

[tasks.lint]
description = "Run linters"
run = """
go vet ./...
staticcheck ./...
"""

[tasks.clean]
description = "Remove build artifacts"
run = "rm -f $BINARY_NAME coverage.out coverage.html"
